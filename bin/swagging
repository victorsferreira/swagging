#!/usr/bin/env node

const cwd = process.cwd();
const execa = require('execa');
const path = require('path');
const fs = require('fs');
const config = require('../package');
const helpers = require('../helpers');

const { displayName } = config;
const targetYamlPath = helpers.getTargetYamlPath();

if (!fs.existsSync(targetYamlPath)) {
  console.log('>>>>>>>>>>', targetYamlPath)
  console.log(`${displayName} found a critical error:`, 'There is no swagger.yaml file in the root path. Fix it and try again.');
  process.exit();
}

const std = execa.shell(`npm-run gulp --gulpfile ${helpers.moduleDir}/gulpfile.js & sleep 2 && npm-run swagger project edit ${helpers.moduleDir}/ & sleep 10 && npm-run http-server -o -p 3000 ${helpers.moduleDir}/public/ui -c-1`);

std.stdout.on('data', function (data) {
  console.log(`${displayName} says:`, data.toString());
});

std.stderr.on('data', function (data) {
  console.log(`${displayName} found an error:`, data.toString());
});

std.on('exit', function (code) {
  console.log(`${displayName} finished working:`, code.toString());
});